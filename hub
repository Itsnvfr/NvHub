local UIS = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local TextService = game:GetService("TextService")

local NvLib = {
    Tabs = {},
    Accent = Color3.fromRGB(0, 255, 215),
    DarkBG = Color3.fromRGB(5, 5, 5),
    SectionBG = Color3.fromRGB(12, 12, 12),
    Font = Enum.Font.Arcade
}

-- [[ UTILS ]]
local function MakeDraggable(topbar, object)
    local dragging, dragInput, dragStart, startPos
    topbar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true; dragStart = input.Position; startPos = object.Position
            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then dragging = false end
            end)
        end
    end)
    topbar.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then dragInput = input end
    end)
    UIS.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - dragStart
            object.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)
end

-- [[ MAIN UI INIT ]]
local Screen = Instance.new("ScreenGui", CoreGui)
Screen.Name = "NvLib_Modern"

function NvLib:CreateWindow(title)
    local TabCount = 0
    
    local Library = {}

    function Library:CreateTab(name)
        TabCount = TabCount + 1
        
        local Main = Instance.new("Frame", Screen)
        Main.Size = UDim2.new(0, 210, 0, 400)
        Main.Position = UDim2.new(0, 50 + (TabCount * 220), 0, 100)
        Main.BackgroundColor3 = NvLib.DarkBG
        Main.BorderSizePixel = 0
        
        -- Sharp Border
        local Stroke = Instance.new("UIStroke", Main)
        Stroke.Color = NvLib.Accent
        Stroke.Thickness = 1.5
        Stroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border

        local TopBar = Instance.new("Frame", Main)
        TopBar.Size = UDim2.new(1, 0, 0, 30)
        TopBar.BackgroundColor3 = NvLib.DarkBG
        TopBar.BorderSizePixel = 0
        
        local Title = Instance.new("TextLabel", TopBar)
        Title.Size = UDim2.new(1, -10, 1, 0)
        Title.Position = UDim2.new(0, 10, 0, 0)
        Title.Text = name:upper()
        Title.Font = NvLib.Font
        Title.TextColor3 = NvLib.Accent
        Title.TextSize = 14
        Title.TextXAlignment = Enum.TextXAlignment.Left
        Title.BackgroundTransparency = 1

        local Container = Instance.new("ScrollingFrame", Main)
        Container.Size = UDim2.new(1, -10, 1, -40)
        Container.Position = UDim2.new(0, 5, 0, 35)
        Container.BackgroundTransparency = 1
        Container.BorderSizePixel = 0
        Container.ScrollBarThickness = 2
        Container.ScrollBarImageColor3 = NvLib.Accent
        Container.CanvasSize = UDim2.new(0, 0, 0, 0)
        
        local Layout = Instance.new("UIListLayout", Container)
        Layout.Padding = UDim.new(0, 5)
        Layout.SortOrder = Enum.SortOrder.LayoutOrder
        
        Layout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
            Container.CanvasSize = UDim2.new(0, 0, 0, Layout.AbsoluteContentSize.Y + 10)
        end)

        MakeDraggable(TopBar, Main)

        local Elements = {}

        function Elements:Toggle(text, default, callback)
            local Enabled = default or false
            local Tgl = Instance.new("TextButton", Container)
            Tgl.Size = UDim2.new(1, 0, 0, 30)
            Tgl.BackgroundColor3 = NvLib.SectionBG
            Tgl.BorderSizePixel = 0
            Tgl.Text = " " .. text
            Tgl.Font = NvLib.Font
            Tgl.TextColor3 = Color3.fromRGB(200, 200, 200)
            Tgl.TextSize = 13
            Tgl.TextXAlignment = Enum.TextXAlignment.Left
            
            local Status = Instance.new("Frame", Tgl)
            Status.Size = UDim2.new(0, 4, 1, 0)
            Status.Position = UDim2.new(1, -4, 0, 0)
            Status.BackgroundColor3 = Enabled and NvLib.Accent or Color3.fromRGB(40, 40, 40)
            Status.BorderSizePixel = 0

            Tgl.MouseButton1Click:Connect(function()
                Enabled = not Enabled
                TweenService:Create(Status, TweenInfo.new(0.2), {BackgroundColor3 = Enabled and NvLib.Accent or Color3.fromRGB(40, 40, 40)}):Play()
                callback(Enabled)
            end)
        end

        function Elements:Button(text, callback)
            local Btn = Instance.new("TextButton", Container)
            Btn.Size = UDim2.new(1, 0, 0, 30)
            Btn.BackgroundColor3 = NvLib.SectionBG
            Btn.BorderSizePixel = 0
            Btn.Text = text:upper()
            Btn.Font = NvLib.Font
            Btn.TextColor3 = Color3.new(1, 1, 1)
            Btn.TextSize = 13

            Btn.MouseButton1Click:Connect(callback)
            
            Btn.MouseEnter:Connect(function()
                TweenService:Create(Btn, TweenInfo.new(0.2), {BackgroundColor3 = Color3.fromRGB(20, 20, 20)}):Play()
            end)
            Btn.MouseLeave:Connect(function()
                TweenService:Create(Btn, TweenInfo.new(0.2), {BackgroundColor3 = NvLib.SectionBG}):Play()
            end)
        end

        function Elements:Slider(text, min, max, default, callback)
            local Value = default
            local Sld = Instance.new("Frame", Container)
            Sld.Size = UDim2.new(1, 0, 0, 45)
            Sld.BackgroundColor3 = NvLib.SectionBG
            Sld.BorderSizePixel = 0
            
            local Label = Instance.new("TextLabel", Sld)
            Label.Size = UDim2.new(1, -10, 0, 20)
            Label.Position = UDim2.new(0, 10, 0, 5)
            Label.BackgroundTransparency = 1
            Label.Text = text .. ": " .. Value
            Label.Font = NvLib.Font
            Label.TextColor3 = Color3.new(1, 1, 1)
            Label.TextSize = 12
            Label.TextXAlignment = Enum.TextXAlignment.Left
            
            local Bar = Instance.new("Frame", Sld)
            Bar.Size = UDim2.new(1, -20, 0, 4)
            Bar.Position = UDim2.new(0, 10, 0, 30)
            Bar.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
            Bar.BorderSizePixel = 0
            
            local Fill = Instance.new("Frame", Bar)
            Fill.Size = UDim2.new((Value - min) / (max - min), 0, 1, 0)
            Fill.BackgroundColor3 = NvLib.Accent
            Fill.BorderSizePixel = 0

            local function Update(input)
                local pos = math.clamp((input.Position.X - Bar.AbsolutePosition.X) / Bar.AbsoluteSize.X, 0, 1)
                Value = math.floor(pos * (max - min) + min)
                Label.Text = text .. ": " .. Value
                Fill.Size = UDim2.new(pos, 0, 1, 0)
                callback(Value)
            end

            local dragging = false
            Sld.InputBegan:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = true; Update(input) end
            end)
            UIS.InputChanged:Connect(function(input)
                if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then Update(input) end
            end)
            UIS.InputEnded:Connect(function(input)
                if input.UserInputType == Enum.UserInputType.MouseButton1 then dragging = false end
            end)
        end

        return Elements
    end

    return Library
end

--- Example Usage ---

local Window = NvLib:CreateWindow("NvHub Premium")

local Combat = Window:CreateTab("Aimbot")
Combat:Toggle("Enable Aimbot", false, function(v) print("Aimbot:", v) end)
Combat:Slider("FOV Size", 0, 500, 150, function(v) print("FOV:", v) end)

local Visuals = Window:CreateTab("Visuals")
Visuals:Toggle("Box ESP", false, function(v) print("ESP:", v) end)
Visuals:Toggle("Rainbow Mode", false, function(v) print("Rainbow:", v) end)

local Misc = Window:CreateTab("Settings")
Misc:Button("Copy Discord", function() setclipboard("discord.gg/link") end)
