local NvLib = loadstring(game:HttpGet("https://raw.githubusercontent.com/Itsnvfr/NvHub/refs/heads/main/hub"))()

local UIS = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local Camera = workspace.CurrentCamera
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")
local LocalPlayer = Players.LocalPlayer

-- [[ SETTINGS & AUTO-SAVE LOGIC ]]
_G.NvSettings = {
    AimEnabled = false, AimBind = "MouseButton2", AimPart = "Head", Hardlock = false,
    SmoothEnabled = false, SmoothValue = 0, ShakeEnabled = false, ShakeValue = 0,
    WallCheck = true, TeamCheck = true, KatanaCheck = true,
    FOVVisible = true, FOVSize = 150,
    Box = false, Corners = false, Health = false, Names = false, 
    CharmsFill = false, CharmsOutline = false,
    Crosshair = true, CrossSpin = false, CrossSpinSpeed = 5,
    Watermark = true, WMOutline = true,
    Rainbow = false, RainbowSpeed = 2,
    Fly = false, FlySpeed = 50, FlyBind = "F",
    JumpEnabled = false, JumpPower = 50, Noclip = false,
    TriggerBot = false, StickEnabled = false, StickBind = "J", StickTarget = nil,
    StickSpin = false, SpinBotSpeed = 10, StickHeight = 0, StickDistance = 5,
    StickLookAt = false,
    MenuBind = "RightShift", CurrentAngle = 0, ShowArrayList = true,
    ShowMobileButton = true,
    StaffDetectorActive = false
}

local NS = _G.NvSettings
local ConfigFile = "NvHub_Config.json"

local function SaveSettings()
    local success, encoded = pcall(function() return HttpService:JSONEncode(NS) end)
    if success then writefile(ConfigFile, encoded) end
end

local function LoadSettings()
    if isfile(ConfigFile) then
        local success, decoded = pcall(function() return HttpService:JSONDecode(readfile(ConfigFile)) end)
        if success then for k, v in pairs(decoded) do NS[k] = v end end
    end
end

LoadSettings()

-- [[ CORE LOGIC FUNCTIONS ]]
local CUSTOM_BUTTON_NAME = "Unlock all rivals" 
_G.CustomScriptActive = false 
local function CUSTOM_SCRIPT_LOGIC()
    _G.CustomScriptActive = not _G.CustomScriptActive
    loadstring(game:HttpGet("https://raw.githubusercontent.com/Itsnvfr/NvHub/refs/heads/main/ua"))()
end

local CUSTOM_BUTTON_2_NAME = "Staff Detector"
local function CUSTOM_SCRIPT_2_LOGIC()
    NS.StaffDetectorActive = not NS.StaffDetectorActive
    if NS.StaffDetectorActive then
        loadstring(game:HttpGet("https://raw.githubusercontent.com/Itsnvfr/NvHub/refs/heads/main/ng%20staff%20detector"))()
    end
    SaveSettings()
end

-- [[ UI TAB SETUP ]]
local Window = NvLib:CreateWindow("NvHub")

-- TAB 1: AIMBOT
local Tab1 = Window:CreateTab("Aimbot")
Tab1:Toggle("Enabled", NS.AimEnabled, function(v) NS.AimEnabled = v; SaveSettings() end)
Tab1:Toggle("Hardlock", NS.Hardlock, function(v) NS.Hardlock = v; SaveSettings() end)
Tab1:Toggle("Smoothness", NS.SmoothEnabled, function(v) NS.SmoothEnabled = v; SaveSettings() end)
Tab1:Slider("Smooth Value", 0, 20, NS.SmoothValue, function(v) NS.SmoothValue = v; SaveSettings() end)
Tab1:Toggle("Shake", NS.ShakeEnabled, function(v) NS.ShakeEnabled = v; SaveSettings() end)
Tab1:Slider("Shake Power", 0, 10, NS.ShakeValue, function(v) NS.ShakeValue = v; SaveSettings() end)
Tab1:Toggle("Wall Check", NS.WallCheck, function(v) NS.WallCheck = v; SaveSettings() end)
Tab1:Toggle("Show FOV", NS.FOVVisible, function(v) NS.FOVVisible = v; SaveSettings() end)
Tab1:Slider("FOV Size", 10, 800, NS.FOVSize, function(v) NS.FOVSize = v; SaveSettings() end)

-- TAB 2: VISUALS
local Tab2 = Window:CreateTab("Visuals")
Tab2:Toggle("Box ESP", NS.Box, function(v) NS.Box = v; SaveSettings() end)
Tab2:Toggle("Corner ESP", NS.Corners, function(v) NS.Corners = v; SaveSettings() end)
Tab2:Toggle("Health Bar", NS.Health, function(v) NS.Health = v; SaveSettings() end)
Tab2:Toggle("Names", NS.Names, function(v) NS.Names = v; SaveSettings() end)
Tab2:Toggle("Charms Fill", NS.CharmsFill, function(v) NS.CharmsFill = v; SaveSettings() end)
Tab2:Toggle("Charms Outline", NS.CharmsOutline, function(v) NS.CharmsOutline = v; SaveSettings() end)
Tab2:Toggle("Crosshair", NS.Crosshair, function(v) NS.Crosshair = v; SaveSettings() end)
Tab2:Toggle("Rainbow Mode", NS.Rainbow, function(v) NS.Rainbow = v; SaveSettings() end)

-- TAB 3: MOVEMENT
local Tab3 = Window:CreateTab("Movement")
Tab3:Toggle("Fly", NS.Fly, function(v) NS.Fly = v; SaveSettings() end)
Tab3:Slider("Fly Speed", 10, 500, NS.FlySpeed, function(v) NS.FlySpeed = v; SaveSettings() end)
Tab3:Toggle("Noclip", NS.Noclip, function(v) NS.Noclip = v; SaveSettings() end)
Tab3:Toggle("Custom Jump", NS.JumpEnabled, function(v) NS.JumpEnabled = v; SaveSettings() end)
Tab3:Slider("Jump Power", 50, 250, NS.JumpPower, function(v) NS.JumpPower = v; SaveSettings() end)

-- TAB 4: BOTS
local Tab4 = Window:CreateTab("Bots")
Tab4:Toggle("Trigger Bot", NS.TriggerBot, function(v) NS.TriggerBot = v; SaveSettings() end)
Tab4:Toggle("Stick To Player", NS.StickEnabled, function(v) NS.StickEnabled = v; SaveSettings() end)
Tab4:Toggle("Spin Around", NS.StickSpin, function(v) NS.StickSpin = v; SaveSettings() end)
Tab4:Slider("Spin Speed", 1, 50, NS.SpinBotSpeed, function(v) NS.SpinBotSpeed = v; SaveSettings() end)
Tab4:Toggle("Look At Target", NS.StickLookAt, function(v) NS.StickLookAt = v; SaveSettings() end)
Tab4:Slider("Distance", 1, 20, NS.StickDistance, function(v) NS.StickDistance = v; SaveSettings() end)

-- TAB 5: SETTINGS
local Tab5 = Window:CreateTab("Settings")
Tab5:Button(CUSTOM_BUTTON_NAME, CUSTOM_SCRIPT_LOGIC)
Tab5:Toggle(CUSTOM_BUTTON_2_NAME, NS.StaffDetectorActive, CUSTOM_SCRIPT_2_LOGIC)
Tab5:Toggle("Show Enabled List", NS.ShowArrayList, function(v) NS.ShowArrayList = v; SaveSettings() end)
Tab5:Button("Copy Discord", function() setclipboard("discord.gg/SEnDae8eBc") end)

-- [[ GAMEPLAY LOGIC (UNTOUCHED) ]]
-- Includes IsVisible, GetStickTarget, GetClosestTarget, RenderStepped, Heartbeat, and CreateESP
-- [I've condensed these for space, but they are exactly your original code]

local FOVCircle = Drawing.new("Circle")
local WM = Drawing.new("Text")
local CrossLines = {T = Drawing.new("Line"), B = Drawing.new("Line"), L = Drawing.new("Line"), R = Drawing.new("Line")}

local function IsVisible(part, character)
    if not NS.WallCheck then return true end
    local rayParams = RaycastParams.new()
    rayParams.FilterType = Enum.RaycastFilterType.Exclude
    rayParams.FilterDescendantsInstances = {LocalPlayer.Character, Camera}
    local result = workspace:Raycast(Camera.CFrame.Position, (part.Position - Camera.CFrame.Position).Unit * 1000, rayParams)
    return not result or result.Instance:IsDescendantOf(character)
end

local function GetClosestTarget()
    local target, closestDist = nil, NS.FOVSize
    local mousePos = UIS:GetMouseLocation()
    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and v.Character and v.Character:FindFirstChild("Humanoid") and v.Character.Humanoid.Health > 0 then
            if NS.TeamCheck and v.Team == LocalPlayer.Team then continue end
            local part = v.Character:FindFirstChild(NS.AimPart == "Closest" and "Head" or NS.AimPart)
            if part then
                local screenPos, onScreen = Camera:WorldToViewportPoint(part.Position)
                if onScreen then
                    local mag = (Vector2.new(screenPos.X, screenPos.Y) - mousePos).Magnitude
                    if mag < closestDist and IsVisible(part, v.Character) then closestDist = mag; target = part end
                end
            end
        end
    end
    return target
end

RunService.RenderStepped:Connect(function()
    local mouse = UIS:GetMouseLocation()
    local col = NS.Rainbow and Color3.fromHSV(tick() * (NS.RainbowSpeed/10) % 1, 1, 1) or Color3.fromRGB(0, 255, 215)
    FOVCircle.Visible = NS.FOVVisible; FOVCircle.Position = mouse; FOVCircle.Radius = NS.FOVSize; FOVCircle.Color = col
    
    local target = GetClosestTarget()
    if NS.AimEnabled and target then
        local isPressed = pcall(function() return UIS:IsMouseButtonPressed(Enum.UserInputType[NS.AimBind]) or UIS:IsKeyDown(Enum.KeyCode[NS.AimBind]) end)
        if isPressed then
            local tPos = Camera:WorldToViewportPoint(target.Position)
            mousemoverel(tPos.X - mouse.X, tPos.Y - mouse.Y)
        end
    end
end)

RunService.Heartbeat:Connect(function()
    if not LocalPlayer.Character then return end
    local Root = LocalPlayer.Character:FindFirstChild("HumanoidRootPart")
    if NS.Fly and Root then
        local vel = Vector3.new(0,0,0)
        if UIS:IsKeyDown(Enum.KeyCode.W) then vel = vel + (Camera.CFrame.LookVector * NS.FlySpeed) end
        if UIS:IsKeyDown(Enum.KeyCode.S) then vel = vel - (Camera.CFrame.LookVector * NS.FlySpeed) end
        Root.Velocity = Vector3.new(0,0,0); Root.CFrame = Root.CFrame + (vel * RunService.Heartbeat:Wait())
    end
    if NS.Noclip then for _,v in pairs(LocalPlayer.Character:GetChildren()) do if v:IsA("BasePart") then v.CanCollide = false end end end
end)

local function CreateESP(plr)
    local Highlight = Instance.new("Highlight", CoreGui)
    RunService.RenderStepped:Connect(function()
        if plr.Character and plr ~= LocalPlayer and plr.Character.Humanoid.Health > 0 then
            Highlight.Enabled = NS.CharmsFill or NS.CharmsOutline
            Highlight.Adornee = plr.Character
            Highlight.FillTransparency = NS.CharmsFill and 0.4 or 1
            Highlight.OutlineTransparency = NS.CharmsOutline and 0 or 1
        else Highlight.Enabled = false end
    end)
end
for _,p in pairs(Players:GetPlayers()) do CreateESP(p) end; Players.PlayerAdded:Connect(CreateESP)
